#!/bin/bash

# source common functions
FUNCTIONS=ts_functions.sh # /path/to../
source $FUNCTIONS
pwhash="zogN6hOIYS8W2"
### MAIN ###
test_for_root
if (( $? != 0 )); then
        echo "Could not proceed"
        echo "are you root?"
        exit 3
fi

if ! password_backup=$(backup_passwords_for_reset); then
        echo $password_backup
	echo "WARNING:Password files could not be backed up! exiting..."
        exit 3
else
        echo $password_backup
fi

# set uid and gid to something unlikely to be used elsewhere
useradd --create-home  --shell /bin/bash -p "$pwhash" --uid 5001 --gid 5001 --groups adm --groups admin  tsuser

if (( $add_user != 0 )); then 
	echo "WARNING: Could not adduser, exiting..."
	exit 3
else	
	echo "tsuser has been created with sudo privileges. It will be deleted on shutdown/reboot."
fi
