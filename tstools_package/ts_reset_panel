#!/bin/bash
help(){
        cat <<EOF 
        usage ts_reset_panel [OPTION]
        -h              prints this message
        -u [USERNAME]   specify the user whose panels will be reset,
			defaults to the user running the command.
        -p /path/to/mountpoint        The directory where the target file system is mounted. Use this if you are working on an external or mounted  drive e.g. a drive mounted from a system rescue cd. 	Implies -u 


	Resets gnome panels to their default state. 
EOF
        exit 0
}

# source common functions
FUNCTIONS=ts_functions.sh # /path/to../
source $FUNCTIONS

### MAIN ###

### process options ###

while getopts ":hu:p:" option; do
        case $option in
                h) help
                   exit
                ;;
                u) user=$OPTARG
		;;
                p) path="$OPTARG"
                ;;
                \?) help
                    exit
                ;;
        esac
done

#set/check user
if [[ -z $user ]]; then
        user=$USER
else
        test_for_user $user $path
        if (( $? != 0 )); then
                echo "$user not found! exiting..."
                exit 3
        fi

        test_for_root
        if [[ $? -ne 0 ]]; then
                echo "You are not root! exiting..."
                exit 3
                fi
fi

# reset panel second stage maybe unnecessary need to test

# set appropriate command and options
if ! reset_gconf $user /apps/panel $path; then
	echo "gconf failed to reset panel" 
	exit 3

#rm -rf /home/$user/.gconf/apps/panel
#if [[ $? -ne 0 ]]; then
#        echo "gconf failed to reset" 
#        EXIT=1
#fi

if [[ ! $path ]] 
	if ! pkill gnome-panel ; then
        	echo "failed to restart gnome-panel" 
        	exit 2
	fi
else
	exit 0
fi
 
